---
layout: post
title: Insert to server
---

증가하는 난수를 DB에 넣는 PHP코드.

저장된 데이터와 GRAFANA를 연결하여 제법 멋진 그래프가 탄생했~~었~~다.

```
<?php
    header("Content-Type: text/html; charset=UTF-8");

    $db_host="localhost";
    $db_user="root"; //MySQL root account
    $db_passwd="passwordml17@";
    $db_name="testdatabase";

    $tag = $_REQUEST["tag"];
    $value = $_REQUEST["value"];

    /*echo $tag;
    echo "  |  ";
    echo $value;
    echo "<br>"; */

    $conn = mysqli_connect($db_host, $db_user, $db_passwd, $db_name); //db connect
    mysqli_query($conn, "set session character_set_connection=utf8;");
    mysqli_query($conn, "set session character_set_results=utf8;");
    mysqli_query($conn, "set session character_set_client=utf8;"); // preventing errors in korean


    for($i=0;$i<5;$i++)
    {
        ob_flush();
        flush();
        sleep(1); // Time interval(1s)

        $rand = ((rand()%100)/1000); //3 decimal places

        $value = $value + $rand; // value increase

        $query = "INSERT INTO sensor (tag, value) VALUES ('$tag', '$value');"; // query define
        $result = mysqli_query($conn, $query);
        
        echo "$tag  |  $value   ";

        if($result)
            echo "<br>Result: OK";
        else
            echo "<br>Result: Error";
    }

    mysqli_close($conn);

?>
```

