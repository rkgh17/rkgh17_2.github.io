---
layout: post
title: Next chap?
---


postgresql + hypertable = __TimscaleDB__



그러나.... 저장은 잘만 되던데 grafana에서 연결이 불가능했다.

hypertable 설정에 대하여 좀더 공부해야 할듯?

인턴이 끝나기 전에 연결을 하고 싶었지만.. 아쉽다

아래는 TimescaleDB에(or postgresql?) 난수를 저장하는 php코드.

```
<?php
    header("Content-Type: text/html; charset=UTF-8");

    @set_time_limit (1000000000000); // MAX TIME in web 
    $db_host="host=localhost";
    $db_port="port=5432";
    $db_passwd="user=postgres password=hj1217";
    $db_name="dbname=fci";

    $AC = $_REQUEST["AC"];
    $SN = $_REQUEST["SN"];
    $val1 = $_REQUEST["val1"];
    $val2 = $_REQUEST["val2"];
    $val3 = $_REQUEST["val3"];
    $val4 = $_REQUEST["val4"];
    $val5 = $_REQUEST["val5"];
    $val6 = $_REQUEST["val6"];
    $val7 = $_REQUEST["val7"];
    $val8 = $_REQUEST["val8"];


    $conn=pg_connect("$db_host $db_port $db_name $db_passwd"); //db connect

    for($i=0;$i<30;$i++)
    {    

      ob_flush();
      flush();
      sleep(2); // Time interval(1s)

      $t_rand1 = ((rand()%100)/1000);
      $t_rand2 = ((rand()%100)/1000);
      $t_rand3 = ((rand()%100)/1000);
      $t_rand4 = ((rand()%100)/1000);
      $t_rand5 = ((rand()%100)/1000);
      $t_rand6 = ((rand()%100)/1000);
      $t_rand7 = ((rand()%100)/1000);
      $t_rand8 = ((rand()%100)/1000);

      $val1 = $val1 + $t_rand1;
      $val2 = $val2 + $t_rand2;
      $val3 = $val3 + $t_rand3;
      $val4 = $val4 + $t_rand4;
      $val5 = $val5 + $t_rand5;
      $val6 = $val6 + $t_rand6;
      $val7 = $val7 + $t_rand7;
      $val8 = $val8 + $t_rand8;

      $query = "INSERT INTO sensor (AC, SN, val1, val2, val3, val4, val5, val6, val7, val8, time) VALUES ('$AC', '$SN', '$val1', '$val2','$val3', '$val4', '$val5', '$val6', '$val7', '$val8', now())";
      //

      if($val1>=35){
        $val1 = $val1 - 15;
      }
      else if($val2>=35){
        $val2 = $val2 - 15;
      }
      else if($val3>=35){
        $val3 = $val3 - 15;
      }
      else if($val4>=35){
        $val4 = $val4 - 15;
      }
      else if($val5>=35){
        $val5 = $val5 - 15;
      }
      else if($val6>=35){
        $val6 = $val6 - 15;
      }
      else if($val7>=35){
        $val7 = $val7 - 15;
      }
      else if($val8>=35){
        $val8 = $val8 - 15;
      }
      $result = pg_query($conn, $query);
      

    }

    pg_close($conn);
    
    /*phpinfo();*/


?>
```
